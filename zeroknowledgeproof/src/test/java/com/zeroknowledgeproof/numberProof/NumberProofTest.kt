package com.zeroknowledgeproof.numberProof

import junit.framework.Assert.assertFalse
import junit.framework.Assert.assertTrue
import org.junit.Test
import java.math.BigInteger

class NumberProofTest {
    @Test
    fun completeProcedure() {
        val tp = NumberProofTrustedParty
        val res = tp.proofValue(1700)
        assertTrue(res)
    }

    @Test
    fun verifierGivesRandomValues() {
        var canGiveOne = false
        var canGiveZero = false

        val v = NumberProofVerifier(BigInteger.ONE)

        for (i in 1..10000) { // Set limit high enough....
            val res = v.requestChallenge()
            canGiveOne = canGiveOne or res
            canGiveZero = canGiveZero or !res
        }

        assert(canGiveOne)
        assert(canGiveZero)
    }

    @Test
    fun verifierAcceptsCorrectResult() {
        val vTrue = NumberProofVerifier(BigInteger("26919556042745368231005517608601670631077276246866179751839705288411396536254887241522523064118049950216025313591492953854752348717104942433760042506256821813959244688526345537424311211594181990718367597701928706793653861078152290423127943898776349203038433974325957593308432637032780064317014275814647228535097524682488573803212818891914088252701514490218054155307288899183921742167365169447399426066713522572611516730709054555055138282722876402542139881904188264916377199601840091643166237732030696177918859561105431189468861237552655424947449200001386096495397699196182355819784337608752066636983246474580127980513", 10))
        val vFalse = NumberProofVerifier(BigInteger("26919556042745368231005517608601670631077276246866179751839705288411396536254887241522523064118049950216025313591492953854752348717104942433760042506256821813959244688526345537424311211594181990718367597701928706793653861078152290423127943898776349203038433974325957593308432637032780064317014275814647228535097524682488573803212818891914088252701514490218054155307288899183921742167365169447399426066713522572611516730709054555055138282722876402542139881904188264916377199601840091643166237732030696177918859561105431189468861237552655424947449200001386096495397699196182355819784337608752066636983246474580127980513", 10))
        val pubkey = BigInteger("2890000")

        // With a False challenge:
        val xFalse = BigInteger("486638850938097416305111200879159188679036802071607323954039547448404710422706269311857609349822273749222291778867584534700973015701488819779518655597426388412245157650101481386242389635902306527336624499984675766936048043243855838481456669005627212489039978754002927448404962910741574855359237187761702048257821208307440063540044789950530908895439669808895986163868778407472434975956607183718181082270372082389296360752848688561975392296960734488823210856455452304957072746745307114104140385611910696552210907649921659623163918337155421492988577371333192422006885386925540208610728953138327435010033327091322666025", 10)
        val yFalse = BigInteger("22059892360075046755692908758681249466120615010566499082327463288386172343004450410226628253299055696933101421550947260324792664412487272481204628055120982967123375328664579239121049755349546192944125956209428471779431864057640776092172659121915925446792147849972825027095369418564353360548137984284561474355", 10)

        // With a true challenge
        val xTrue = BigInteger("728928324835643197352008658890433509586104344772992402216118503206824431080874163828657020994680221154415808288568120566853265281766172898960949586424173294449281032191681149045408406407253055217583560585002746207839190598728101948587320657829113219651206343171341567700352424222462399384476117422565641996009439116589206659610470933133914865665905498876531256462860621864161827091986585479068854574058546027733222776515654132580605583253218480404798391623193325468020823491303903855126053044479630099585476933018803744573574454113301747636717003532469564551379191237140692941217022646740434565558438203136783876241", 10)
        val yTrue = BigInteger("45897743504174677893804050396032395584195183646013526607204602913408790545341598162689192357724551053249663373640486008473801943413811273554906540791747423557556509050040400080798814329159565563229356599849082085431516403244398005593763123615435066650581069959964629150396759212467163377239092127977051953759300", 10)


        assertTrue(vFalse.verify(xFalse, yFalse, pubkey, false))
        assertTrue(vTrue.verify(xTrue, yTrue, pubkey, true))
    }

    @Test
    fun verifierRejectWrongResult() {
        val v = NumberProofVerifier(BigInteger("26919556042745368231005517608601670631077276246866179751839705288411396536254887241522523064118049950216025313591492953854752348717104942433760042506256821813959244688526345537424311211594181990718367597701928706793653861078152290423127943898776349203038433974325957593308432637032780064317014275814647228535097524682488573803212818891914088252701514490218054155307288899183921742167365169447399426066713522572611516730709054555055138282722876402542139881904188264916377199601840091643166237732030696177918859561105431189468861237552655424947449200001386096495397699196182355819784337608752066636983246474580127980513", 10))
        val pubkey = BigInteger("2890000")
        val xFalse = BigInteger("486638850938097416305111200879159188679036802071607323954039547448404710422706269311857609349822273749222291778867584534700973015701488819779518655597426388412245157650101481386242389635902306527336624499984675766936048043243855838481456669005627212489039978754002927448404962910741574855359237187761702048257821208307440063540044789950530908895439669808895986163868778407472434975956607183718181082270372082389296360752848688561975392296960734488823210856455452304957072746745307114104140385611910696552210907649921659623163918337155421492988577371333192422006885386925540208610728953138327435010033327091322666025", 10)
        val yTrue = BigInteger("45897743504174677893804050396032395584195183646013526607204602913408790545341598162689192357724551053249663373640486008473801943413811273554906540791747423557556509050040400080798814329159565563229356599849082085431516403244398005593763123615435066650581069959964629150396759212467163377239092127977051953759300", 10)
        assertFalse(v.verify(xFalse, yTrue, pubkey, false))
    }
}